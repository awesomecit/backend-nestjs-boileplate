#!/bin/sh
echo "ğŸš€ Smart pre-push hook - analyzing branch changes..."

# Analizza i cambiamenti da pushare vs origin/main o HEAD~5
test_strategy=$(scripts/smart-test-selector.sh determine origin/main 2>/dev/null || scripts/smart-test-selector.sh determine HEAD~5)

echo "ğŸ“Š Changes to push: $test_strategy"

case "$test_strategy" in
    "nestjs")
        echo "ğŸ§ª Running complete NestJS test suite..."
        npm run test
        npm run test:e2e
        ;;
    "infrastructure")
        echo "ğŸ—ï¸ Running infrastructure and monitoring tests..."
        npm run test:infrastructure
        npm run test:monitoring
        ;;
    "all")
        echo "ğŸ¯ Running FULL test suite (mixed changes detected)..."
        npm run test:all
        ;;
    "quick")
        echo "âš¡ Running health checks..."
        npm run health
        ;;
    *)
        echo "ğŸ“ Minimal changes detected - running quick validation..."
        npm run health --silent
        ;;
esac

echo "âœ… Pre-push validation completed!"
